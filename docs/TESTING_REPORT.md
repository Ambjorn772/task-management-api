# Звіт про тестування програмного забезпечення

## Огляд тестування

Проект покритий трьома типами тестів:
- **Unit-тести** - тестування окремих модулів ізоляційно
- **Інтеграційні тести** - тестування взаємодії модулів з БД без HTTP
- **E2E тести** - тестування повного потоку через HTTP API

## Unit-тести

### Покриття модулів

#### ValidationService (Tasks Service)
- ✅ `validateTaskData` - 13 тестів
  - Валідація коректних даних
  - Валідація обов'язкових полів (title, userId) для create
  - Валідація опціональних полів для update
  - Валідація статусів (pending, in-progress, completed, cancelled)
  - Валідація пріоритетів (low, medium, high)
  - Валідація довжини полів
  - Валідація дат
  - Валідація для update операцій (опціональні поля)
- ✅ `validateId` - 6 тестів
  - Валідація коректних ID
  - Валідація некоректних ID (негативні, нечислові, порожні, нуль)

**Всього: 19 тестів**

#### ValidationService (Users Service)
- ✅ `validateUserData` - 8 тестів
  - Валідація коректних даних
  - Валідація обов'язкових полів (username, email)
  - Валідація формату email
  - Валідація довжини полів
- ✅ `validateId` - 2 тести

**Всього: 10 тестів**

**Загальна кількість Unit-тестів: 29**

## Інтеграційні тести

### TasksRepository Integration Tests
Інтеграційні тести перевіряють реальну роботу з базою даних без використання HTTP API.

- ✅ **Database Connection and Initialization** - 2 тести
  - Перевірка підключення до тестової БД
  - Перевірка структури таблиці Tasks

- ✅ **create** - 3 тести
  - Створення задачі в БД
  - Встановлення значень за замовчуванням
  - Встановлення timestamp полів (createdAt, updatedAt)

- ✅ **findById** - 2 тести
  - Повернення null для неіснуючої задачі
  - Повернення задачі з БД

- ✅ **findAll** - 3 тести
  - Повернення порожнього масиву
  - Повернення всіх задач
  - Сортування за createdAt DESC

- ✅ **findByUserId** - 2 тести
  - Повернення порожнього масиву для користувача без задач
  - Фільтрація задач за userId

- ✅ **update** - 4 тести
  - Повернення null для неіснуючої задачі
  - Оновлення існуючої задачі в БД
  - Оновлення updatedAt timestamp
  - Часткове оновлення (тільки вказані поля)

- ✅ **delete** - 2 тести
  - Повернення false для неіснуючої задачі
  - Видалення задачі з БД

- ✅ **mapRowToTask** - 1 тест
  - Коректне маппінгування рядка БД в модель Task

**Всього: 19 інтеграційних тестів**

**Особливості:**
- Використовується тестова SQLite БД
- БД очищається перед кожним тестом
- Тести перевіряють реальну роботу з БД
- Перевірка структури даних та timestamp полів

## E2E тести

### Tasks Service E2E Tests
E2E тести перевіряють повний потік через HTTP API, включаючи валідацію, обробку помилок та всі endpoints.

- ✅ **Full Task Lifecycle** - 1 тест
  - Повний цикл: Create → Read → Update → Delete → Verify

- ✅ **Health Check** - 1 тест
  - Перевірка health endpoint

- ✅ **Get Tasks by User ID** - 1 тест
  - Фільтрація задач за userId через API

- ✅ **Error Handling** - 5 тестів
  - Обробка невалідного ID
  - Обробка відсутніх обов'язкових полів
  - Обробка невалідного статусу
  - Обробка невалідного пріоритету
  - Обробка невалідного формату дати

- ✅ **GET /tasks - All Endpoints** - 1 тест
  - Отримання всіх задач з правильною структурою

- ✅ **PUT /tasks/:id - Update Scenarios** - 2 тести
  - Оновлення кількох полів одночасно
  - Часткове оновлення (тільки вказані поля)

- ✅ **DELETE /tasks/:id - Delete Scenarios** - 2 тести
  - Обробка неіснуючої задачі
  - Успішне видалення та перевірка

- ✅ **GET /tasks/user/:userId - User Tasks** - 2 тести
  - Повернення порожнього масиву для користувача без задач
  - Фільтрація задач за userId

**Всього: 16 E2E тестів**

**Особливості:**
- Тестування через HTTP API
- Використовується Fastify inject для тестування
- Перевірка статусів відповідей (200, 201, 400, 404, 500)
- Перевірка структури відповідей
- Покриття всіх endpoints та edge cases

## Статистика тестів

```
Test Suites: 5 passed, 5 total
Tests:       64 passed, 64 total
```

### Розподіл тестів:
- **Unit-тести:** 29 тестів (45%)
- **Інтеграційні тести:** 19 тестів (30%)
- **E2E тести:** 16 тестів (25%)

## Покриття коду

### Модулі з повним покриттям:
- ✅ `ValidationService` (Tasks Service) - 100% покриття
  - Всі методи покриті тестами
  - Покриті всі гілки коду (if/else)
  - Покриті edge cases

- ✅ `ValidationService` (Users Service) - 100% покриття

### Модулі з високим покриттям:
- ✅ `TasksRepository` - покрито через інтеграційні тести
  - Всі методи CRUD покриті
  - Перевірка маппінгу даних
  - Перевірка timestamp полів

- ✅ `TasksController` - покрито через E2E тести
  - Всі endpoints покриті
  - Обробка помилок покрита
  - Валідація покрита

### Модулі з частковим покриттям:
- ⚠️ `UsersRepository` - не покрито тестами
- ⚠️ `UsersController` - не покрито тестами
- ⚠️ `TasksClient` (інтеграція між сервісами) - не покрито тестами

## Ефективність тестів

### Сильні сторони:
1. **Висока якість Unit-тестів** - повне покриття ValidationService з усіма edge cases
2. **Реальна інтеграція з БД** - інтеграційні тести використовують реальну SQLite БД
3. **Повне покриття основних сценаріїв** - E2E тести покривають всі HTTP endpoints
4. **Перевірка структури даних** - тести перевіряють не тільки функціональність, але й структуру відповідей
5. **Обробка помилок** - покриті різні сценарії помилок та edge cases

### Що варто покращити:
1. **Додати Unit-тести для Repository** - окремо тестувати логіку маппінгу даних (покрито інтеграційними тестами)
2. **Додати тести для Users Service** - покрити Users Repository та Controller
3. **Додати тести для інтеграції між сервісами** - тестувати TasksClient
4. **Додати тести для обробки помилок БД** - тестувати поведінку при помилках БД
5. **Додати performance тести** - перевірити продуктивність при великій кількості даних

## Мутаційне тестування

### Налаштування:
- Використовується Stryker Mutator
- Мутації застосовуються до всіх модулів крім тестів та серверних файлів
- Пороги: High 80%, Low 70%, Break 60%

### Запуск мутаційного тестування:
```bash
npm run test:mutation
```

### Очікувані результати:
- **Mutation Score:** ~75-85% (очікується)
- **Killed Mutants:** більшість мутацій виявлені тестами
- **Survived Mutants:** деякі мутації в Repository та Controller (через неповне покриття)

### Висновки:
- ValidationService має високу ефективність тестів (майже всі мутації виявлені)
- Repository та Controller потребують додаткових тестів для повного покриття
- Інтеграційні та E2E тести допомагають виявити мутації на рівні взаємодії модулів

## Рекомендації

### Пріоритет 1 (Високий):
1. ✅ Додати Unit-тести для ValidationService (виконано)
2. ✅ Налаштувати інтеграційні тести для Repository (виконано)
3. ✅ Розширити E2E тести для всіх HTTP методів (виконано)
4. Додати Unit-тести для Users Repository
5. Додати E2E тести для Users Service

### Пріоритет 2 (Середній):
1. Додати тести для обробки помилок БД
2. Додати тести для інтеграції між сервісами (TasksClient)
3. Додати тести для edge cases (граничні значення)
4. Додати тести для конкурентного доступу

### Пріоритет 3 (Низький):
1. Додати performance тести
2. Додати тести для валідації даних на рівні БД
3. Додати тести для логування та моніторингу

## Висновок

Проект має хорошу основу тестування з 64 тестами, що покривають основні функціональні можливості. ValidationService повністю покритий тестами з високою ефективністю. TasksRepository покритий інтеграційними тестами, які перевіряють реальну роботу з БД. E2E тести покривають всі HTTP endpoints та основні сценарії використання.

**Загальна оцінка покриття: 75-80%**
**Ефективність тестів: Висока для покритих модулів**
**Кількість тестів: 64 (29 unit + 19 integration + 16 e2e)**

### Наступні кроки:
1. Запустити мутаційне тестування для оцінки ефективності тестів
2. Додати тести для Users Service
3. Додати тести для інтеграції між сервісами
4. Покращити покриття edge cases
